<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>JIvE library</title>
	<script src="canvas.js"></script>
	<script src="imageLoader.js"></script>
	<script src="eventEmitter.js"></script>
	<script src="camera.js"></script>
	<script src="tiledMap.js"></script>
	<script src="tiledMapRenderer.js"></script>
	<script src="utils.js"></script>
	<script src="inputHandler.js"></script>
	<script src="entity.js"></script>
	<script src="jive.js"></script>



	<style>

		html {
			height: 100%;
			overflow: hidden
		}

		body {
			margin: 0px;
			padding: 0px;
			height: 100%;
			overflow: hidden;
			font-family: 'Proxima Nova Regular', 'Helvetica Neue', Arial, Helvetica, sans-serif;
			font-size: 12px;
		}

		canvas {
			border: 1px solid #d3d3d3;
			background-color: #f1f1f1;
		}

	</style>
</head>

<body>
	


	<script>	

	url = "https://raw.githubusercontent.com/skaparelos/random-tests/master/map.json"
	var map, mapRenderer, camera, ih, woRenderer;

	function init(){
		mapRenderer = JIVE.MapRenderer();
		camera = JIVE.Camera();

		// register bindings
		ih = JIVE.InputHandler().init();
		ih.bind(JIVE.Keys.ARROW_UP, 'move-up');
		ih.bind(JIVE.Keys.W, 'move-up');
		ih.bind(JIVE.Keys.ARROW_DOWN, 'move-down');
		ih.bind(JIVE.Keys.S, 'move-down');
		ih.bind(JIVE.Keys.ARROW_LEFT, 'move-left');
		ih.bind(JIVE.Keys.A, 'move-left');
		ih.bind(JIVE.Keys.ARROW_RIGHT, 'move-right');
		ih.bind(JIVE.Keys.D, 'move-right');
		ih.bind(JIVE.Mouse.LEFT, 'click-left');
		ih.bind(JIVE.Mouse.RIGHT, 'click-right');

		// you can do somethind like this, but it is veeery slow
		camera.on('move-up', function(){
			//camera.move({up:1, right:0, left:0, down:0}, dt)

			// TODO problem with dt. we need to be able to access dt
			// when calling the camera.
		});


		ih.on('click-left', function(e) {
			//console.log("left click oeooe");
			//console.log(Utils.screen2MapCoords(e, map, camera));
			entities[0].move(1, 0, map);
		})

		ih.on('click-right', function(){
			console.log("right click");
		});

		map = JIVE.Map();
		entities = [];
		map.loadJSON(url, function(){ 
			var m = map.getMap()["map"][2];
			for (var h = 0; h < map.getMap()["mapheight"]; h++){
				for (var w = 0; w < map.getMap()["mapwidth"]; w++){
					if (m[h][w] != 0){
						entities.push(new JIVE.Entity(h, w, m[h][w]));
					}
				}
			}

			JIVE.reqAnimFrame(animate);
		});
	}

	function animate(dt){

		if (ih.getActionState("move-up")){
			camera.move({up:1, right:0, left:0, down:0}, dt);
			//console.log("up");
		}

		if (ih.getActionState('move-left')){
			camera.move({up:0, right:0, left:1, down:0}, dt);
		}

		if (ih.getActionState('move-right')){
			camera.move({up:0, right:1, left:0, down:0}, dt);
		}

		if (ih.getActionState('move-down')){
			camera.move({up:0, right:0, left:0, down:1}, dt);
		}

		if (map.isLoaded()){
			mapRenderer.draw(map, camera);
		}


	}


	</script>

</body>